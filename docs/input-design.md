# yumicuit 入力設計

## 最重要課題

**記録したい情報は多い。しかし誘導すると覚醒してしまう。**

これがこのアプリの核心的なジレンマであり、
他アプリに真似できないノウハウの部分。

---

## 記録したい情報

### 感情・印象

- トータルの印象（幸せ、懐かしい、楽しい、怖い、不思議）
- ★での自己評価（どれくらい良い夢だったか）

### 夢の種類

- 一度見た夢か、初めての夢か
- 繰り返し行っている街・場所なら何回目くらいか
- 明晰夢だったか、夢と気づかなかったか
- 淫夢だったか

### 感覚

- 全体としての色調（暖色、寒色、モノクロ）
- 匂いはあったか
- 体の感覚（飛ぶ、落ちる、走る等）があったか

### 登場人物

- 知っている人が出てきたか
- それは誰か

### 舞台

- どこだったか（実在の場所、架空の場所）
- 広い範囲だったか、狭い範囲だったか

### 夢の構造

- 夢の長さ（一瞬、短い、長い、すごく長い）
- どうやって目覚めたか
  - 自然に目が覚めた
  - アラームで起きた
  - 夢の中で死んで起きた
  - 怖くて起きた
  - 夢だと気づいて起きた
  - 誰かに起こされた
  - 物音で起きた
  - など
- 場面転換はあったか（何回くらい）
- 論理的に変だったところ（矛盾）
- この場所に前にも来た感覚（既視感）

### 視覚情報（画像生成に直結）

- 時間帯（朝、昼、夕方、夜、深夜、曖昧）
- 天気（晴れ、曇り、雨、雪、嵐、室内でわからない）
- 光源（太陽光、月光、街灯、蛍光灯、暗闇、不思議な光）
- 視点（自分の目線、第三者視点で自分を見ていた、視点が曖昧）

### 空間情報

- 屋内/屋外（室内、屋外、両方、曖昧）
- 高さ（地上、高いところ、地下、空中、水中）
- 時代感（現代、未来、過去、ファンタジー、混在）

### 動きの情報

- 移動手段（歩き、走り、飛行、乗り物、瞬間移動、動けない）
- スピード感（ゆっくり、普通、速い、時間が歪んでいた）

### 音の情報

- 音があったか（あった、なかった、覚えていない）
- どんな音（会話、音楽、環境音、無音なのに不自然）

### 感情の強度

- 感情の強さ（弱い、普通、強い、圧倒的）
- 起きた後も残っていたか（すぐ消えた、しばらく残った、今も残っている）

---

## ジレンマ

### 誘導のリスク

```
質問を見せる → 読む → 脳が覚醒 → 夢の記憶が消える
```

既存アプリの失敗パターン：
- 「今日の気分は？」
- 「夢のカテゴリを選んでください」
- 「タグを付けてください」

**文字を読ませた時点で負け。**

### 自由作文のリスク

```
何も誘導しない → ユーザーはストーリーだけ書く → 感覚情報が抜け落ちる
```

昼にDream Cameraで再現しようとしても、
「色は？」「匂いは？」「広さは？」がわからない。

---

## 解決アプローチ

### 原則

1. **朝は何も聞かない**（自由作文のみ）
2. **昼に補完させる**（記憶がまだ残っているうちに）
3. **補完の仕方を学習させる**（修行の一部として）

### フェーズ分離

```
[朝] 断片だけ自由に書く
        ↓
[昼・早め] AIが「足りない情報」を質問
        ↓
[昼] ユーザーが補完（まだ記憶が残っている）
        ↓
[昼] 「そういえばこうだった！」と追記
        ↓
[昼] AIがストーリー生成（入力は上書きされない）
        ↓
[夕方以降] Dream Cameraで再現
```

### 入力と出力は別管理

**絶対原則：ユーザーの入力をAI出力で上書きしない**

```
ユーザー入力（不可侵）
├── 朝の断片
├── 昼の追記「そういえばこうだった！」
└── 補完回答（色、広さ、匂い等）

AI出力（別管理）
├── 生成ストーリー（複数バージョン）
├── 確定ストーリー
└── 夢の種（キーワード + 核の一文）
```

ユーザーが思い出したことは、いつでも追記できる。
AIの生成結果とは独立して保存される。

### 昼の補完質問（AI生成）

AIがユーザーの断片を見て、足りない情報を質問する。

例：
```
断片: 「港」「緑の鳥」「雷」「笑った」

AIの質問:
- この港は広かったですか？狭かったですか？
- 空の色は何色でしたか？
- 匂いはありましたか？
- この夢を見たのは初めてですか？
- 知っている人は出てきましたか？
```

**ただし、これは昼に聞く。朝は聞かない。**

---

## 朝の入力UI

### 完全自由

```
┌─────────────────────────────────┐
│                                 │
│  ▌                              │  ← カーソルだけ
│                                 │
│                                 │
│                                 │
└─────────────────────────────────┘
```

- 何も表示しない
- プレースホルダーもなし
- ヒントもなし
- ただのテキストエリア

### ユーザーは自由に書く

```
港
緑の鳥
雷
笑った
追いかけっこ
懐かしい感じ
空が紫だった
```

「懐かしい感じ」「空が紫だった」のような情報を
自然に書いてくれることを期待する。

---

## 学習させる（修行）

### 問題

最初のユーザーは「何を書けばいいかわからない」。
ストーリーだけ書いて、感覚情報を書かない。

### 解決

**昼の補完を繰り返すうちに、自然と朝に書くようになる。**

```
1週目: 断片だけ → 昼に「色は？匂いは？」と聞かれる
2週目: 断片 + 色を書くようになる
3週目: 断片 + 色 + 感情
4週目: 断片 + 色 + 感情 + 広さ + ...
```

これが「修行」。
朝の記録が自然と豊かになっていく。

### 昼の質問をパーソナライズ

AIがユーザーの傾向を学習：
- 「このユーザーはいつも色を書き忘れる」
- 「このユーザーは広さを書いたことがない」
- 「このユーザーは匂いをよく書く」

足りない情報だけを質問する。

---

## 昼の補完UI

### 質問形式

```
┌─────────────────────────────────┐
│ 断片:                           │
│ 港、緑の鳥、雷、笑った           │
├─────────────────────────────────┤
│ 補完:                           │
│                                 │
│ □ 広い空間だった               │
│ □ 狭い空間だった               │
│ □ わからない                   │
│                                 │
│ 色調は？                       │
│ ○ 暖かい色 ○ 冷たい色 ○ モノクロ │
│ ○ 覚えていない                 │
│                                 │
│ 知っている人は出てきた？        │
│ [                            ] │
│                                 │
└─────────────────────────────────┘
```

**選択式 + 自由記述の組み合わせ。**

### AIが質問を生成

毎回同じ質問ではなく、断片の内容に応じて質問を変える。

- 「港」があるなら「海の匂いはしましたか？」
- 「笑った」があるなら「誰と一緒でしたか？」
- 「雷」があるなら「怖かったですか？楽しかったですか？」

---

## データモデル拡張

```typescript
// 昼の追記
interface Addition {
  text: string;
  addedAt: number;  // Unix timestamp
}

interface DreamRecord {
  // === ユーザー入力（不可侵） ===

  // 朝の断片（自由記述）
  tokens: string[];
  createdAt: number;

  // 昼の追記（「そういえばこうだった！」）
  additions?: Addition[];

  // 昼の補完（構造化された回答）
  supplement?: {
    // 感情・印象
    emotion?: string[];           // ['幸せ', '懐かしい']
    rating?: number;              // 1-5 ★評価

    // 夢の種類
    isRecurring?: boolean;        // 繰り返しの夢か
    recurringCount?: number;      // 何回目くらい
    isLucid?: boolean;            // 明晰夢か
    isErotic?: boolean;           // 淫夢か

    // 感覚
    colorTone?: 'warm' | 'cool' | 'mono' | 'vivid' | 'unknown';
    hasSmell?: boolean;
    smellDescription?: string;
    hasBodySensation?: boolean;
    bodySensationDescription?: string;

    // 登場人物
    hasKnownPerson?: boolean;
    knownPersons?: string[];      // 名前リスト

    // 舞台
    location?: string;
    locationScale?: 'wide' | 'narrow' | 'unknown';
    isRealPlace?: boolean;

    // 夢の構造
    dreamLength?: 'instant' | 'short' | 'long' | 'very_long' | 'unknown';
    wakeUpReason?:
      | 'natural'           // 自然に目が覚めた
      | 'alarm'             // アラームで起きた
      | 'died_in_dream'     // 夢の中で死んで起きた
      | 'scared'            // 怖くて起きた
      | 'became_lucid'      // 夢だと気づいて起きた
      | 'someone_woke_me'   // 誰かに起こされた
      | 'noise'             // 物音で起きた
      | 'other';            // その他
    wakeUpReasonOther?: string;
    sceneChanges?: number;              // 場面転換の回数（0 = なし）
    contradiction?: string;             // 論理的に変だったところ
    dejaVu?: boolean;                   // この場所に前にも来た感覚

    // 視覚情報（画像生成に直結）
    timeOfDay?: 'morning' | 'noon' | 'evening' | 'night' | 'late_night' | 'ambiguous';
    weather?: 'clear' | 'cloudy' | 'rain' | 'snow' | 'storm' | 'indoor_unknown';
    lightSource?: 'sunlight' | 'moonlight' | 'streetlight' | 'fluorescent' | 'darkness' | 'mysterious';
    viewpoint?: 'first_person' | 'third_person' | 'ambiguous';

    // 空間情報
    indoorOutdoor?: 'indoor' | 'outdoor' | 'both' | 'ambiguous';
    height?: 'ground' | 'high' | 'underground' | 'sky' | 'underwater';
    era?: 'modern' | 'future' | 'past' | 'fantasy' | 'mixed';

    // 動きの情報
    movement?: 'walking' | 'running' | 'flying' | 'vehicle' | 'teleport' | 'immobile';
    speed?: 'slow' | 'normal' | 'fast' | 'time_distorted';

    // 音の情報
    hasSound?: boolean;
    soundType?: 'conversation' | 'music' | 'ambient' | 'silent_but_unnatural';
    soundDescription?: string;

    // 感情の強度
    emotionIntensity?: 'weak' | 'normal' | 'strong' | 'overwhelming';
    emotionLingers?: 'faded_quickly' | 'lingered' | 'still_present';
  };

  // === AI出力（別管理） ===

  storyVersions?: StoryVersion[];
  confirmedStory?: ConfirmedStory;
  seeds?: DreamSeeds;
}
```

**入力と出力は完全に分離。ユーザーの入力はAI出力で上書きされない。**

---

## 競合優位性

### 他アプリにできないこと

1. **朝は何も聞かない**（覚醒させない）
2. **昼にAIが賢く質問**（断片に応じて変える）
3. **修行で自然と豊かになる**（ユーザーが学習する）
4. **補完情報がDream Cameraの精度を上げる**

### 真似されにくい理由

- AIの質問生成ロジックがノウハウ
- ユーザーの傾向学習がノウハウ
- 「修行」という文化設計がノウハウ

---

## 微調整ポイント

### 昼の質問数

- 多すぎると面倒
- 少なすぎると情報不足
- **3-5問が目安**

### 質問の順序

- 重要度順（色→広さ→匂い→...）
- 断片に関連する順

### 「覚えていない」の扱い

- 選択肢として常に用意
- 無理に思い出させない
- 「覚えていない」も情報

### プライバシー

- 「誰が出てきた？」は敏感
- ローカル保存のみ
- 共有時は匿名化オプション

---

## 実装優先度

### Phase 1

- 朝：自由記述のみ
- 昼：手動で補完（質問なし）

### Phase 2

- 昼：AIが質問を生成
- 基本的な補完項目

### Phase 3

- ユーザー傾向の学習
- パーソナライズされた質問
- Dream Cameraとの連携
